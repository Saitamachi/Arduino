#include <Servo.h>
#include <SoftwareSerial.h>

#define MIN_PULSE_LENGTH 1000
#define MAX_PULSE_LENGTH 1100

Servo esc1;
Servo esc2;
Servo esc3;
Servo esc4;

char data;

int MOTOR_1 = 3;
int MOTOR_2 = 5;
int MOTOR_3 = 6;
int MOTOR_4 = 9;

int motor1 = 0;
int motor2 = 0;
int motor3 = 0;
int motor4 = 0;

int initESC(){
  esc1.attach(MOTOR_1, 1000, 2000);
  esc2.attach(MOTOR_2, 1000, 2000);
  esc3.attach(MOTOR_3, 1000, 2000);
  esc2.attach(MOTOR_4, 1000, 2000);


  esc1.write(90);
  esc2.write(90);
  esc3.write(90);
  esc4.write(90);

  esc1.writeMicroseconds(1500);
  esc2.writeMicroseconds(1500);
  esc3.writeMicroseconds(1500);
  esc4.writeMicroseconds(1500);

  delay(3000);
  return 1;
  
  }

void setup() {
  Serial.begin(9600);
  while ( !Serial ) {
    ;
  }
  mySerial.begin(9600);

  int escOk = initESC();
  delay(1000);
  displayInstructions();
}

void loop() {
  if (mySerial.available()){
    data = mySerial.read();

    switch (data){ 
      //0
      case 48:mySerial.println("Sending minimum throttle");
              esc1.writeMicroseconds(MIN_PULSE_WIDTH);
              esc2.writeMicroseconds(MIN_PULSE_WIDTH);
              esc3.writeMicroseconds(MIN_PULSE_WIDTH);
              esc4.writeMicroseconds(MIN_PULSE_WIDTH);
              break;

      //1
      case 49:mySerial.println("Sending maximum throttle");
              esc1.writeMicroseconds(MAX_PULSE_WIDTH);
              esc2.writeMicroseconds(MAX_PULSE_WIDTH);
              esc3.writeMicroseconds(MAX_PULSE_WIDTH);
              esc4.writeMicroseconds(MAX_PULSE_WIDTH);
              break;
      
        
      // 2
      case 50 : mySerial.print("Running test in 3");
                delay(1000);
                mySerial.print(" 2");
                delay(1000);
                mySerial.println(" 1...");
                delay(1000);
                test();
      break;
      }
    }
}
void test()
{
    for (int i = MIN_PULSE_LENGTH; i <= MAX_PULSE_LENGTH; i += 5) {
        mySerial.print("Pulse length = ");
        mySerial.println(i);
        
        esc1.writeMicroseconds(i);
        esc2.writeMicroseconds(i);
        esc3.writeMicroseconds(i);
        esc4.writeMicroseconds(i);

        
        delay(1000);
    }

    mySerial.println("STOP");
    esc1.writeMicroseconds(MIN_PULSE_LENGTH);
    esc2.writeMicroseconds(MIN_PULSE_LENGTH);
    esc3.writeMicroseconds(MIN_PULSE_LENGTH);
    esc4.writeMicroseconds(MIN_PULSE_LENGTH);
}

/**
 * Displays instructions to user
 */
void displayInstructions()
{  
    mySerial.println("READY - PLEASE SEND INSTRUCTIONS AS FOLLOWING :");
    mySerial.println("\t0 : Send min throttle");
    mySerial.println("\t1 : Send max throttle");
    mySerial.println("\t2 : Run test function\n");
}
